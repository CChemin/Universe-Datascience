{
    "id": "{{service.name}}",
    "cpus": {{service.cpus}},
    "mem":  {{service.mem}},
    "instances":1,
    "cmd": "{{#script_demarrage.URI}} chown root:users $MESOS_SANDBOX && chmod 775 $MESOS_SANDBOX &&  runuser -l jovyan -c 'sh /mnt/mesos/sandbox/*.sh' && {{/script_demarrage.URI}} {{#advanced.jupyter_lab}} start.sh jupyter-lab {{/advanced.jupyter_lab}} {{^advanced.jupyter_lab}} start-notebook.sh {{/advanced.jupyter_lab}} {{#advanced.security_token.enable}} --NotebookApp.token='{{advanced.security_token.token}}'{{/advanced.security_token.enable}} {{^advanced.security_token.enable}} --NotebookApp.token=''{{/advanced.security_token.enable}}start.sh jupyter-lab --NotebookApp.token='{{jupyter.password}}'",
    "container": {
        "type": "DOCKER",
        "docker": {
            "image": "{{jupyter.image}}",
            "portMappings": [
                { "containerPort": 8888 , "name": "jupyter"}
            ]
        }
    },
    "networks": [
      {
        "name": "dcos",
        "mode": "container"
      }
    ],
    "healthChecks": [{
        "protocol": "MESOS_TCP",
        "gracePeriodSeconds": 300,
        "intervalSeconds": 60,
        "portIndex": 0,
        "timeoutSeconds": 15,
        "maxConsecutiveFailures": 3
    }],
    "labels": {
        "HAPROXY_GROUP": "external",
        "HAPROXY_0_VHOST": "{{networking.virtual-host}}",
        "HAPROXY_0_REDIRECT_TO_HTTPS": "{{networking.https-redirect}}",
        "HAPROXY_0_FRONTEND_HEAD": "",
        "HAPROXY_0_FRONTEND_BACKEND_GLUE": "",
        "HAPROXY_0_ENABLED":"true",
        {{#networking.whitelist.enable}}
        "HAPROXY_0_BACKEND_NETWORK_ALLOWED_ACL": "{{networking.whitelist.ip}}",
        {{/networking.whitelist.enable}}
        "MARATHON_SINGLE_INSTANCE_APP": "true"
    },
    "fetch": [
        {{#script.uri}}
        {
        "uri": "{{script.uri}}",
        "extract": false,
        "executable": true,
        "cache": false
    }
    {{/script.uri}}
    ],

    "upgradeStrategy": {
       "maximumOverCapacity": 0,
       "minimumHealthCapacity": 0
    }
}
